#监听test_topic,链接localhost:9094
kafka-console-consumer -topic=test_topic -brokers=localhost:9094

```
kafka 基本概念
同步异步概念
    生产者同步指: 发送消息后 要接受一个响应 是否成功
    异步: 不需要返回响应 成功与否
    消费者异步:消费者什么时候去消费,取决去消费者自身

```

```
生产者
再有多个分区的情况下怎么选择分区
    轮询
    随机
    哈希:更具消息的key来筛选一个分区
    哈希的key 映射到1024个槽,如0-10 对应分区1,10-500对应 分区2
消息有序: 生产者的发送 就是 消费者的 消费顺序:如订单 发送订单->取消订单 这一步一定是要有序的,
    如果要保证消息的有序,就要保证消息发送到同一个分区,很多时候不需要保证如 买一个鼠标和一个键盘, 不用订单就不需要有序
    就要做到用一个业务或订单有序 使用 选择哈希选择分区 如订单(id/分区)%取余 选择分区
```

```
消费者 和 消费者组
消费者都归属于一个消费者组
    比如新用户注册,搜索和推荐都关心这个消息
在同一个消费者组内,组内消费者不能重复消费同一个分区(一个分区最多一个消费者): 1一个消费者可以消费多个分区,2一个分区在同一时刻,只能被一个消费者消费
消息重复消费可能源自,生产者重复发送或者消费者消费成功但是没有提交:
    如消费成功但没来得及提交,此时数据库已经更新并提交事务,
    宕机了,没有告诉kafka 偏移量时崩溃了,其他消费者就会消费,造成重复消费,
一个分区 是不会同时被两个消费者消费的,所以消费者性能差,并不能通过提升数量实现
```


```
broker - 一个消息队列进程
    
```

```
topic 
一个topic至少有一个分区

```

```
分区
分为 主分区 和 从分区 推荐至少两个从分区
    发送消息到kafka时,会写入主分区再同步到从分区
    如果主分区崩溃了,可以从分区 在同步
kafka分区设计多少,要根据生产者速率,消费者速率,消息体多长 
    算法:要知道每一个分区的qps能撑多少,max(发送者总速率/单一分区写入速率,发送这总速率/单一消费者速率) + buffer
写入主分区后同步从分区失败时,从分区数据就会丢失   通过acks
    0:客户端发送一次,不需要服务端确认 ,tcp协议返回了 ack 就可以了
    1:客户端发送,并且需要服务端写入到主分区  ,主分区确认写入就可以了
    -1:客户端发送,并且需要服务端同步到所有ISR(In sync Replicas),所有的ISR都确认
    从上到下,性能变差,可靠性上升.需要性能 0 ,需要消息不丢失 -1
分区在broker放法
    正常情况下同一个topic的分区会尽量均匀分散到所有broker上,
    意味着:多个主分区之间.不会在同一个broker上,第二:同一个分区的主分区和从分区,也不会在同一个broker上,
    
```

```
kafka面试 
消息积压 > 异步消费 > 消息消费但没提交 > 批量提交 > 重试 > 怎么做幂等 > 利用redis的高可用
>数据库压力大 > 批量接口提交 > 核心就是单个操作变成批量 > 引入mvcc原理
```
